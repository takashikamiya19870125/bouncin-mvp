# 認証システム設計書

## 🎯 改善目標
現実的な組織構造に対応：一人が複数の役割（上司・部下）を持つ

## 📊 現在の問題点
- 役割選択が毎回必要
- 一人が複数役割を持つ現実に対応していない
- 個人の継続的な利用体験が不足

## 🔄 改善後のユーザーフロー

### 1. ログイン → 個人ダッシュボード
```
ログイン → 統合ダッシュボード
├── 上司として (N人の部下との1on1)
│   ├── 田中さんとの1on1 (次回: 7/20)
│   ├── 佐藤さんとの1on1 (次回: 7/22)
│   └── 山田さんとの1on1 (次回: 7/25)
└── 部下として (M人の上司との1on1)
    ├── 部長との1on1 (次回: 7/21)
    └── 課長との1on1 (次回: 7/24)
```

### 2. 役割別アクション
- **上司として**: 事前準備 → 記録 → 振り返り
- **部下として**: 準備 → 振り返り

## 🗄️ 新データモデル設計

### Person（個人）
```python
{
    'id': UUID,
    'email': string,      # ログイン用
    'password': string,   # ハッシュ化
    'name': string,
    'department': string,
    'created_at': ISO datetime
}
```

### Relationship（関係）
```python
{
    'id': UUID,
    'manager_id': UUID,    # Person.id
    'subordinate_id': UUID, # Person.id
    'created_at': ISO datetime,
    'active': boolean
}
```

### Meeting（ミーティング）
```python
{
    'id': UUID,
    'relationship_id': UUID,  # Relationship.id
    'date': ISO datetime,
    'categories': [string],
    'key_points': [string],
    'follow_up': string,
    'manager_learning': string,
    'subordinate_satisfaction': string,
    'subordinate_gains': [string],
    'subordinate_feedback': string
}
```

## 🖥️ 新UI設計

### 1. ログイン画面
```
┌─────────────────────────────────┐
│        1on1アシスタント           │
├─────────────────────────────────┤
│  Email: [________________]      │
│  Password: [________________]   │
│  [ログイン]                      │
│                                 │
│  新規登録はこちら                 │
└─────────────────────────────────┘
```

### 2. 統合ダッシュボード
```
┌─────────────────────────────────┐
│  田中太郎さん のダッシュボード      │
├─────────────────────────────────┤
│  📊 上司として (3人の部下)         │
│  ┌─────────────────────────────┐ │
│  │ 佐藤さん | 次回: 7/20 | [準備] │ │
│  │ 山田さん | 次回: 7/22 | [準備] │ │
│  └─────────────────────────────┘ │
│                                 │
│  👤 部下として (2人の上司)         │
│  ┌─────────────────────────────┐ │
│  │ 部長    | 次回: 7/21 | [準備] │ │
│  │ 課長    | 次回: 7/24 | [準備] │ │
│  └─────────────────────────────┘ │
└─────────────────────────────────┘
```

## 🔧 実装手順

### Phase 1: 基本認証
1. **ログイン機能**
   - 簡単なセッション管理
   - パスワードハッシュ化
   - ログイン状態の維持

2. **データモデル変更**
   - Person, Relationship テーブル追加
   - Meeting テーブル更新

### Phase 2: 統合ダッシュボード
1. **個人ダッシュボード**
   - 上司としての部下一覧
   - 部下としての上司一覧
   - 次回1on1予定表示

2. **関係管理**
   - 上司-部下関係の登録
   - 組織図的表示

### Phase 3: 拡張機能
1. **部門管理**
2. **権限管理**
3. **組織分析**

## 💡 実装上の考慮点

### セキュリティ
- パスワードのハッシュ化 (bcrypt)
- セッション管理 (Flask-Session)
- CSRF対策

### UX改善
- 自動ログイン維持
- 最後にアクセスした画面を記憶
- 通知機能（次回1on1リマインダー）

### スケーラビリティ
- 部門別権限管理
- 大規模組織対応
- パフォーマンス最適化

## 🎯 期待効果

1. **現実的な利用**: 一人が複数役割を自然に切り替え
2. **継続利用**: 個人の利用履歴・習慣化
3. **組織管理**: 部門全体の1on1状況可視化
4. **スケーラビリティ**: 大規模組織でも利用可能

## 📈 成功指標

- **ログイン継続率**: 週1回以上 > 80%
- **役割切り替え利用**: 両方の役割利用 > 60%
- **1on1実施頻度**: 従来比 > 150%
- **満足度**: 4.5/5.0 以上